# Windows Scheduler GUI - 開發文檔

## 概述

本文檔整合了 Windows Scheduler GUI 的所有開發實作說明，包括主視窗、導航系統、排程對話框和執行預覽等核心元件的實作細節。

---

## 1. 主視窗實作

### 概述

已完成任務 6.1：實作主視窗結構，符合 design.md 中的規範。

### 實作內容

#### 1.1 主視窗結構 (MainWindow)

- **檔案位置**: `src/gui/main_window.py`
- **功能特點**:
  - 完整的選單列（檔案、編輯、檢視、工具、說明）
  - 統一導航結構（Overview、Schedules、Logs、Settings、Help）
  - 狀態列顯示系統狀態和連接狀態
  - 響應式佈局，支援視窗大小調整
  - 鍵盤快捷鍵支援

#### 1.2 應用程式入口 (SchedulerApp)

- **檔案位置**: `src/gui/scheduler_app.py`
- **功能特點**:
  - 配置管理（自動載入/儲存）
  - 錯誤處理和異常管理
  - 應用程式生命週期管理

#### 1.3 統一導航系統

按照 design.md 規範實作的五個主要頁面：

1. **Overview (系統概覽)**
   - 系統統計資訊（活躍任務、總執行次數、成功率）
   - 最近活動記錄
   - 系統狀態監控

2. **Schedules (排程管理)**
   - 排程清單和管理（待後續實作）

3. **Logs (執行記錄)**
   - 任務執行歷史和日誌（待後續實作）

4. **Settings (系統設定)**
   - 系統配置選項（待後續實作）

5. **Help (說明文件)**
   - 使用指南和支援資訊（待後續實作）

### 設計特點

#### 符合 design.md 規範

1. **主視窗佈局**:
   ```
   ┌─────────────────────────────────────────────────────────────┐
   │ ◆ Windows-MCP     Overview  Schedules  Logs  Settings  Help │
   ├─────────────────────────────────────────────────────────────┤
   │                                                             │
   │    [主要內容區域 - 根據選中的導航項目顯示對應頁面]           │
   │                                                             │
   └─────────────────────────────────────────────────────────────┘
   ```

2. **統一導航結構**: 採用現代化 Web 風格界面設計
3. **響應式設計**: 支援視窗大小調整和全螢幕模式
4. **本地化支援**: 繁體中文界面

#### 技術實作

- **GUI 框架**: Python Tkinter
- **配置管理**: JSON 格式配置文件
- **模組化設計**: 清晰的類別結構和職責分離
- **錯誤處理**: 完整的異常處理機制

### 配置文件

應用程式會自動在 `.config/config.json` 中儲存配置：

```json
{
  "schedule_check_frequency": 1,
  "notifications_enabled": true,
  "log_recording_enabled": true,
  "log_retention_days": 30,
  "max_retry_attempts": 3,
  "ui_theme": "default",
  "language": "zh-TW",
  "window_width": 1024,
  "window_height": 768,
  "auto_start_scheduler": true,
  "minimize_to_tray": true,
  "show_splash_screen": true,
  "debug_mode": false
}
```

---

## 2. 統一導航系統實作

### 概述

已完成任務 6.2：建立統一導航系統，符合 design.md 中的規範。

### 實作內容

#### 2.1 NavigationFrame 類別 (`src/gui/navigation.py`)

**核心功能**:
- 統一導航結構管理
- 頁面切換和狀態管理
- 響應式佈局支援
- 鍵盤快捷鍵支援
- 導航歷史記錄

**主要特點**:
- ✅ 現代化 Web 風格界面設計
- ✅ 五個主要導航頁面（Overview、Schedules、Logs、Settings、Help）
- ✅ 響應式佈局，支援視窗大小調整
- ✅ 鍵盤快捷鍵支援（Ctrl+1~4, F1）
- ✅ 頁面狀態管理和切換動畫
- ✅ 導航歷史記錄功能

#### 2.2 導航結構

| 導航項目 | 中文名稱 | 功能描述 | 快捷鍵 |
|---------|---------|---------|--------|
| Overview | 系統概覽 | 顯示系統統計和最近活動 | Ctrl+1 |
| Schedules | 排程管理 | 管理和編輯排程任務 | Ctrl+2 |
| Logs | 執行記錄 | 查看任務執行歷史 | Ctrl+3 |
| Settings | 系統設定 | 配置應用程式設定 | Ctrl+4 |
| Help | 說明文件 | 使用指南和支援 | F1 |

#### 2.3 頁面管理器 (`src/gui/page_manager.py`)

**功能特點**:
- 統一的頁面生命週期管理
- 頁面間的資料傳遞機制
- 頁面狀態保存和恢復
- 動態頁面載入和卸載

### 使用方式

#### 2.4 直接啟動 GUI

```bash
python src/gui/scheduler_app.py
```

#### 2.5 從主程式啟動

```bash
python main.py --gui
```

#### 2.6 測試導航系統

```bash
python tmp_rovodev_test_navigation.py
```

---

## 3. 排程對話框實作

### 概述

排程對話框提供了完整的任務建立和編輯介面，包含所有必要的輸入欄位，支援多種觸發時間類型、條件觸發和動態動作類型選擇。

### 實作元件

#### 3.1 ScheduleDialog (`src/gui/dialogs/schedule_dialog.py`)

主要對話框類別，協調所有元件：
- **分頁介面**：包含 5 個分頁：基本資訊、排程設定、動作設定、選項、預覽
- **驗證功能**：驗證所有輸入欄位
- **預覽生成**：顯示執行詳細資訊
- **儲存/取消/測試**功能

#### 3.2 TriggerTimeWidget (`src/gui/widgets/trigger_time_widget.py`)

支援多種觸發時間類型：
- **一次性**：在指定日期/時間執行一次
- **每日**：每天在指定時間重複執行
- **每週**：在選定的星期幾重複執行
- **自訂**：以自訂間隔重複（分鐘/小時/天）
- **結束時間**配置（可選）

#### 3.3 ConditionalTriggerWidget (`src/gui/widgets/conditional_trigger_widget.py`)

支援基於條件的執行：
- **視窗標題包含**：當任何視窗標題包含指定文字時執行
- **視窗標題等於**：當視窗標題完全符合時執行
- **視窗存在**：當指定應用程式視窗存在時執行
- **程序執行中**：當指定程序正在執行時執行
- **時間範圍**：僅在指定時間範圍內執行（HH:MM-HH:MM）
- **系統閒置**：當系統閒置指定分鐘數時執行

#### 3.4 ActionTypeWidget (`src/gui/widgets/action_type_widget.py`)

所有動作類型的動態介面：
- **啟動/關閉應用程式**：應用程式名稱輸入
- **調整視窗大小**：寬度和高度參數
- **移動視窗**：X 和 Y 座標
- **視窗控制**：最小化、最大化、還原、聚焦
- **點擊元素**：應用程式名稱和點擊座標
- **輸入文字**：應用程式名稱、文字輸入和位置
- **發送按鍵**：逗號分隔的按鍵組合
- **自訂命令**：PowerShell 命令輸入

### 整合點

#### 3.5 控制按鈕小工具

更新 `src/gui/widgets/control_buttons_widget.py`：
- **新增任務**按鈕現在開啟 ScheduleDialog 進行建立
- **編輯任務**按鈕現在開啟 ScheduleDialog 進行編輯
- 新增 `_on_task_saved()` 方法處理任務持久化

#### 3.6 排程頁面

更新 `src/gui/pages/schedules_page.py`：
- **從詳細資訊編輯**功能現在使用 ScheduleDialog
- 新增與 TaskManager 的任務儲存整合

### 使用範例

#### 3.7 建立新任務

```python
from src.gui.dialogs.schedule_dialog import ScheduleDialog

def create_task():
    dialog = ScheduleDialog(parent_widget, on_save=handle_task_save)
    result = dialog.show()
    if result:
        print(f"Created task: {result.name}")

def handle_task_save(task):
    task_manager.create_task(task)
```

#### 3.8 編輯現有任務

```python
def edit_task(existing_task):
    dialog = ScheduleDialog(parent_widget, task=existing_task, on_save=handle_task_save)
    result = dialog.show()
    if result:
        print(f"Updated task: {result.name}")

def handle_task_save(task):
    task_manager.update_task(task.id, task)
```

---

## 4. 執行預覽小工具實作

### 概述

ExecutionPreviewWidget 是一個完整實作的 Tkinter 小工具，用於顯示排程任務的執行預覽。該小工具提供了詳細的視覺化預覽，包括動作參數、條件觸發、執行時間軸和安全警告。

### 功能特性

#### 4.1 實作ExecutionPreviewWidget，顯示將要執行的具體操作 ✅

ExecutionPreviewWidget 已完全實作，提供以下功能：

- **基本資訊顯示**：排程名稱、目標應用程式
- **排程設定顯示**：支援一次性、每日、每週、自訂間隔等排程類型
- **動作資訊顯示**：詳細的動作類型和參數說明
- **執行選項顯示**：重複執行、失敗重試、通知、日誌記錄等選項

#### 支援的動作類型：
- `LAUNCH_APP` - 啟動應用程式
- `CLOSE_APP` - 關閉應用程式
- `RESIZE_WINDOW` - 調整視窗大小
- `MOVE_WINDOW` - 移動視窗位置
- `MINIMIZE_WINDOW` - 最小化視窗
- `MAXIMIZE_WINDOW` - 最大化視窗
- `CLICK_ELEMENT` - 點擊UI元素
- `TYPE_TEXT` - 輸入文字
- `SEND_KEYS` - 發送快捷鍵
- `CUSTOM_COMMAND` - 執行自訂命令

#### 4.2 建立動作參數和條件觸發的可視化顯示 ✅

**動作參數顯示**：
- 根據不同動作類型顯示相應的參數
- 參數驗證和格式化顯示
- 安全性警告和注意事項

**條件觸發顯示**：
- 視窗標題條件
- 程序存在條件
- 時間範圍條件
- 系統閒置條件
- 條件邏輯說明

#### 4.3 實作即時預覽更新機制 ✅

**即時更新功能**：
- 配置變更時自動更新預覽
- 高效的文字更新機制
- 錯誤處理和狀態管理
- 使用者體驗優化

**更新觸發條件**：
- 排程名稱變更
- 目標應用程式變更
- 排程設定變更
- 動作類型和參數變更
- 執行選項變更

#### 4.4 建立執行前確認機制 ✅

**安全確認功能**：
- 危險操作警告
- 參數驗證確認
- 執行前最終檢查
- 使用者確認對話框

**確認項目**：
- 動作類型安全性
- 參數完整性
- 排程合理性
- 潛在風險提醒

### 技術特點

#### 4.5 高效能實作

- **文字快取**：避免重複的文字格式化操作
- **增量更新**：只更新變更的部分
- **錯誤處理**：配置錯誤時顯示友善的錯誤訊息
- **效能優化**：使用高效的文字更新機制，避免不必要的重繪

#### 4.6 使用者體驗

- **直觀介面**：清晰的資訊層次和視覺設計
- **即時回饋**：配置變更時立即顯示預覽
- **錯誤提示**：友善的錯誤訊息和修正建議
- **安全警告**：潛在風險的明確提示

### 使用方式

#### 4.7 基本使用

```python
from gui.widgets.execution_preview_widget import ExecutionPreviewWidget

# 建立小工具
preview_widget = ExecutionPreviewWidget(parent_widget)

# 更新預覽
config = {
    'name': '測試排程',
    'target_app': 'notepad',
    'schedule': {...},
    'action_type': ActionType.LAUNCH_APP,
    'action_params': {...},
    'options': {...}
}
preview_widget.update_preview(config)
```

#### 4.8 在 ScheduleDialog 中使用

ExecutionPreviewWidget 已整合到 ScheduleDialog 中，會自動：

1. 監聽配置變更
2. 即時更新預覽
3. 顯示錯誤訊息
4. 提供執行確認

---

## 5. 功能特點總結

### 已實作功能

- ✅ 主視窗結構和佈局
- ✅ 選單列和工具列
- ✅ 統一導航系統
- ✅ 狀態列
- ✅ 系統概覽頁面
- ✅ 配置管理
- ✅ 視窗事件處理
- ✅ 鍵盤快捷鍵
- ✅ 錯誤處理
- ✅ 排程對話框完整功能
- ✅ 執行預覽小工具
- ✅ 任務建立和編輯
- ✅ 條件觸發支援
- ✅ 多種動作類型支援

### 待實作功能（後續任務）

- ⏳ 排程管理頁面詳細功能
- ⏳ 執行記錄頁面
- ⏳ 系統設定頁面
- ⏳ 說明文件頁面
- ⏳ 系統匣功能
- ⏳ 通知系統

## 6. 測試狀態

所有主要元件已通過基本測試，包括：
- 視窗初始化
- 配置載入
- 導航結構建立
- 頁面管理
- 事件處理
- 排程對話框功能
- 執行預覽更新
- 任務建立和編輯

## 7. 使用方式

### 7.1 直接啟動 GUI

```bash
python src/gui/scheduler_app.py
```

### 7.2 從主程式啟動

```bash
python main.py --gui
```

### 7.3 測試特定功能

```bash
# 測試主視窗
python tmp_rovodev_test_gui.py

# 測試導航系統
python tmp_rovodev_test_navigation.py

# 測試排程對話框
python test_dialog_minimal.py

# 測試執行預覽
python demo_execution_preview.py
```

---

本開發文檔整合了所有主要 GUI 元件的實作說明，為開發團隊提供完整的技術參考。